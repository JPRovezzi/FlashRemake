<!DOCTYPE html>
<html>
<body>

<!--Title-->
<h1 style="text-align: center;">"Flash-Calc"</h1>

<!--Problem-->
<table>
    <tr>
        <td>Problem name:</td>
        <td><input type="text"  id="problem_name" name="name" value="llecalas2"></td>
    </tr>
</table>

<br>
<table>
    <!-- Create rows -->
    <tr>
        <!-- Create cells in each row -->
        <td>Configuration:</td>
        <td></td>
      </tr>
    <tr>
      <td>OS:</td>
      <td id="os"></td>
    </tr>
    <tr>
      <td>Model:</td>
      <td id="model"></td>
    </tr>
    <tr>
      <td>Parameter table:</td>
      <td id="partable"></td>
    </tr>
    <tr>
        <td><br></td>
        <td><br></td>
    </tr>
    <tr>
        <td>T:</td>
        <td id="temperature"></td>
        <td>K</td>
    </tr>
    <tr>
        <td>P:</td>
        <td id="pressure"></td>
        <td>atm</td>
    </tr>
  </table>
<br>
<br>
<div id="showdatainput">
</div>
<br>
<div id="wrapper">
    Number of components:
</div>
<br>
<br>
<br>
<p>Comments:</p> 
<textarea id="comment" name="comment" rows="4" cols="50">
</textarea>
<br>
<br>
<div id="div_download">
</div>

<script>
//#region Get the problem name element.
var problem_name = document.getElementById("problem_name");
//#endregion

//#region Get the os element selection box.
var os = document.getElementById("os");
var os_box = document.createElement("select");
os_box.className = "os_box";
var os_option = document.createElement("option");
    os_option.value = "linux_ubuntu";
    os_option.text = "Linux_Ubuntu";
    os_box.appendChild(os_option);
var os_option = document.createElement("option");
    os_option.value = "windows";
    os_option.text = "Windows";

os_box.appendChild(os_option);
os.appendChild(os_box);

//#endregion

//#region Get the model element selection box.
var model = document.getElementById("model");
var model_box = document.createElement("select");
model_box.className = "model_box";
var model_option = document.createElement("option");
    model_option.value = "0";
    model_option.text = "UNIFAC";
    model_box.appendChild(model_option);
var model_option = document.createElement("option");
    model_option.value = "1";
    model_option.text = "A-UNIFAC";

model_box.appendChild(model_option);
model.appendChild(model_box);
//#endregion

//#region Get the "partable" element selection box
var partable = document.getElementById("partable");
var partable_box = document.createElement("select");
partable_box.className = "partable_box";
var partable_option = document.createElement("option");
    partable_option.value = "1";
    partable_option.text = "Liquid-Liquid";
    partable_box.appendChild(partable_option);
var partable_option = document.createElement("option");
    partable_option.value = "2";
    partable_option.text = "Vapor-Liquid";
    partable_box.appendChild(partable_option);
var partable_option = document.createElement("option");
    partable_option.value = "3";
    partable_option.text = "Infinity dil.";

partable_box.appendChild(partable_option);
partable.appendChild(partable_box);
//#endregion

//#region Get the temperature element input box 
var temperature = document.getElementById("temperature");
var temperature_box = document.createElement("input");
temperature_box.className = "temperature_box";
temperature_box.id = "temperature_box";
temperature_box.type = "number";
temperature_box.min = "1";
temperature_box.max = "1000000";
temperature_box.value = "273";
temperature.appendChild(temperature_box);

//#endregion

//#region Get the pressure element input box 
var pressure = document.getElementById("pressure");
var pressure_box = document.createElement("input");
pressure_box.className = "pressure_box";
pressure_box.id = "pressure_box";
pressure_box.type = "number";
pressure_box.min = "1";
pressure_box.max = "1000000";
pressure_box.value = "1";
pressure.appendChild(pressure_box);
//#endregion

//#region Calculation config
/*
    '!   icalc:  0-' **** FLASH CALCULATION ****'
    '!           1-' **** BINODAL CURVE CALCULATION ****'
    '!           2-' **** CALCULATION OF UNIQUAC PARAMETERS FROM UNIFAC **** '
    '!   model:  0-' MODEL USED FOR LIQUID PHASE NON-IDEALITY: UNIFAC'
    '!           1-' MODEL USED FOR LIQUID PHASE NON-IDEALITY: UNIQUAC'
    '!   ipr:    1-' ** COMPARISON OF ACTIVITIES CALCULATED BY UNIFAC AND 
                    UNIQUAC, RESPECTIVELY **'
    '!   iout:   1-'open 'lleasoccuzada.OUT''
    '!   novap:  0-'VAPOR PHASE INCLUDED IN FLASH-CALCULATIONS'
    '!   ig:     0-'write compositions'
    '!           1-'write compositions and activities'
    '!   ipareq: 1-'liquid-liquid parameters table (UNIFAC)'
    '!           2-'liquid-vapor parameters table (UNIFAC)'
    '!           3-'infinite dilution parameters table (UNIFAC)'
    '!           4-'GC-EOS parameters'
*/
var icalc = 0
var ipr   = 0
var iout  = 1
var novap = 0
var ig    = 1
//#endregion

//#region Create a button to print the data input
var showdatainput = document.getElementById("showdatainput");
var showdatainputButton = document.createElement("input");
showdatainputButton.id = "showdatainput";
showdatainputButton.type = "button";
showdatainputButton.value = "Save";
showdatainput.appendChild(showdatainputButton);

showdatainputButton.onclick = ()=> {
    var os_sel = os_box.options[os_box.selectedIndex].text
    var model_sel = model_box.options[model_box.selectedIndex].text
    var partable_sel = partable_box.options[partable_box.selectedIndex].text
    
    alert("Saved problem data and configuration:\n\n"+
    "#-PROBLEM-NAME:".padEnd(23,"_")        + problem_name.value    + "\n"  +
    "#-OPERATING-SYSTEM:".padEnd(24,"_")    + os_sel    + "\n"  +
    "#-MODEL:".padEnd(25,"_")               + model_sel + "\n"  +
    "#-PARAMETERS-TABLE:".padEnd(24,"_")    + partable_sel  + "\n\n"        +
    "#-TEMPERATURE_(K):".padEnd(24,"_")     + temperature_box.value + "\n"  +
    "#-PRESSURE_(ATM):".padEnd(25,"_")      + pressure_box.value    + "\n\n"    +
    "-> FLASH-CALCULATION;".padEnd(0,"_")   + "\n"  +
    `-> COMPARISON OF ACTIVITIES CALCULATED BY ${model_sel};`   + "\n"      +
    "-> OPEN 'lleasoccuzada.OUT';"  + "\n"  +
    "-> VAPOR PHASE INCLUDED IN FLASH-CALCULATIONS;"   + "\n"   +
    "-> WRITE COMPOSITIONS AND ACTIVITIES."
    );    
};

//#endregion

//#region Set the Group list from the partable information.

var grouplist1 = ["None",
    "(CH3)",
    "(CH2)",
    "(CH)",
    "(C)",
    "(CH2=CH)",
    "(CH=CH)",
    "(CH=C)",
    "(CH2=C)",
    "(ACH)",
    "(AC)",
    "(ACCH3)",
    "(ACCH2)",
    "(ACCH)",
    "(OH)",
    "(P1)",
    "(P2)",
    "(H2O)",
    "(ACOH)",
    "(CH3CO)",
    "(CH2CO)",
    "(CHO)",
    "(FURF)",
    "(COOH)",
    "(HCOOH)",
    "(CH3COO)",
    "(CH2COO)",
    "(CH3O)",
    "(CH2O)",
    "(CH-O)",
    "(FCH2O)",
    "(CH2CL)",
    "(CHCL)",
    "(CCL)",
    "(CH2CL2)",
    "(CHCL2)",
    "(CCL2)",
    "(CHCL3)",
    "(CCL3)",
    "(CCL4)",
    "(ACCL)",
    "(CH3CN)",
    "(CH2CN)",
    "(ACNH2)",
    "(CH3NO2)",
    "(CH2NO2)",
    "(CHNO2)",
    "(ACNO2)",
    "(CH2OH)2",
    "(DEOH)",
    "(C5H5N)",
    "(C5H4N)",
    "(C5H3N)",
    "(TCLE)",
    "(MFA)",
    "(DMFA)",
    "(TMS)",
    "(ME2SO)"
    ];
    var grouplist2 = ["None",
        "(CH3)",
        "(CH2)",
        "(CH)",
        "(C)",
        "(CH2=CH)",
        "(CH=CH)",
        "(CH2=C)",
        "(CH=C)",
        "(C=C)",
        "(ACH)",
        "(AC)",
        "(ACCH3)",
        "(ACCH2)",
        "(ACCH)",
        "(OH)",
        "(CH3OH)",
        "(H2O)",
        "(ACOH)",
        "(CH3CO)",
        "(CH2CO)",
        "(CHO)",
        "(CH3COO)",
        "(CH2COO)",
        "(HCOO)",
        "(CH3O)",
        "(CH2O)",
        "(CH-O)",
        "(FCH2O)",
        "(CH3NH2)",
        "(CH2NH2)",
        "(CHNH2)",
        "(CH3NH)",
        "(CH2NH)",
        "(CHNH)",
        "(CH3N)",
        "(CH2N)",
        "(ACNH2)",
        "(C5H5N)",
        "(C5H4N)",
        "(C5H3N)",
        "(CH3CN)",
        "(CH2CN)",
        "(COOH)",
        "(HCOOH)",
        "(CH2CL)",
        "(CHCL)",
        "(CCL)",
        "(CH2CL2)",
        "(CHCL2)",
        "(CCL2)",
        "(CHCL3)",
        "(CCL3)",
        "(CCL4)",
        "(ACCL)",
        "(CH3NO2)",
        "(CH2NO2)",
        "(CHNO2)",
        "(ACNO2)",
        "(CS2)",
        "(CH3SH)",
        "(CH2SH)",
        "(FURF)",
        "(CH2OH)2",
        "(I)",
        "(BR)",
        "(CH=-C)",
        "(C=-C)",
        "(ME2SO)",
        "(ACRY)",
        "CL-C=C)",
        "(ACF)",
        "(DMFA)",
        "(DMF-2)",
        "(CF3)",
        "(CF2)",
        "(CF)",
        "(COO)",
        "(SIH3)",
        "(SIH2)",
        "(SIH)",
        "(SI)",
        "(SIH2O)",
        "(SIHO)",
        "(SIO)"
    ]
    var grouplist3 = ["Empty"] 
;
//#endregion

//#region Get the wrapper element for the component's input boxes
var wrapper = document.getElementById("wrapper");


// Create an input box for n_components
var nInput = document.createElement("input");
nInput.id = "nInput";
nInput.type = "number";
nInput.min = "2";
nInput.max = "10";
nInput.value = "2";
wrapper.appendChild(nInput);

// Create a set button
var setButton = document.createElement("input");
setButton.id = "setButton";
setButton.type = "button";
setButton.value = "Create table";
wrapper.appendChild(setButton);

// Add an onclick event listener to setButton
setButton.onclick = () => {
    var n_components = nInput.value; // Number of components
    var n_maxgroups = 10; // Max number of functional groups per component
    var partable_sel = partable_box.options[partable_box.selectedIndex].value
    var grouplist = ["ERROR"]
    if (partable_sel == 1){
        grouplist = grouplist1
    } 
    else if(partable_sel == 2){
        grouplist = grouplist2
    } 
    else grouplist = grouplist3
    // Remove any existing selection boxes or lines for each n_components line
    var boxes = document.getElementsByClassName("box");
    while (boxes.length > 0) {
        boxes[0].remove();
    }
    var line = document.getElementsByClassName("line");
    while (line.length > 0) {
        line[0].remove();
    }
  
    // Create n_maxgroups selection boxes for each n_components line
    for (var i = 0; i < n_components; i++) {
        // Create a container element for each n_components line
        var line = document.createElement("div");
        line.className = "line";
        wrapper.appendChild(line);
        
        // Create a label for each Component line
        var label = document.createElement("span");
        label.textContent = "Component " + (i + 1) + ":"
        +".".repeat(18)+"Group: ";
        line.appendChild(label);
    
        // Create n_maxgroups selection boxes for each line
        for (var j = 0; j < n_maxgroups; j++) {
            // Create a selection box
            var box = document.createElement("select");
            box.className = "box";
            // Add the grouplist options for each box
            for (var k = 0; k < grouplist.length; k++) { 
                var option = document.createElement("option");
                option.value = k;
                option.text = grouplist[k];
                //option.text = "1";
                box.appendChild(option);
            }
      
            // Append the box to the line
            line.appendChild(box);
        }
        // Create a container element for each line
        var line = document.createElement("div");
        line.className = "line";
        wrapper.appendChild(line);
    
        // Create a label for each Component line
        var label = document.createElement("span");
        label.textContent = ".".repeat(22) + "Number of groups: ";
        line.appendChild(label);
        for (var j = 0; j < n_maxgroups; j++) {
            // Create a selection box
            var ngroup_Input = document.createElement("input");
            ngroup_Input.id = "ngroup_Input";
            ngroup_Input.className = "input"
            ngroup_Input.type = "number";
            ngroup_Input.min = "0";
            ngroup_Input.max = "100000"; //Also adjust Chromium box size
            ngroup_Input.value = "0";
            ngroup_Input.setAttribute("size", 5); //Adjust Firefox box size 
            
          
            // Append the box to the line
            line.appendChild(ngroup_Input);
        }
    }
    var option_size = document.querySelectorAll("option"); //Adjust box size
    option_size.forEach(function(option) {
        if (option.textContent.length > 13) {
            option.textContent = option.textContent.substring(0, 13) + "...";
        }
    });
};
//#endregion

//#region Create a download button
var div_download = document.getElementById("div_download");
var downloadButton = document.createElement("input");
downloadButton.id = "downloadButton";
downloadButton.type = "button";
downloadButton.value = "Download";
div_download.appendChild(downloadButton);
// Add an onclick event listener to downloadButton
downloadButton.onclick = () => {
    var values = [];
    
    var model_sel = model_box.options[model_box.selectedIndex].value
    var partable_sel = partable_box.options[partable_box.selectedIndex].value

    values.push(`"${problem_name.value}"`) //Print name of file
    values.push(
        `${icalc},${model_sel},${ipr},${iout},${novap},${ig},${partable_sel}`)
    //#region Get all the input and selection values
    
    
    values.push(`${nInput.value}`);
    var lines = document.getElementsByClassName("line");
    for (var i = 0; i < (lines.length-1); (i++)) {
        var lineValues = [];
        var boxes = lines[i].getElementsByClassName("box");
        var inputs = lines[i+1].getElementsByClassName("input");
        for (var j = 0; j < boxes.length; j++) {
            lineValues.push(boxes[j].value);
            lineValues.push(inputs[j].value);
        }
        //for (var j = 0; j < inputs.length; j++) {
            //lineValues.push(inputs[j].value);
            //}
        if (i % 2 == 0)
        values.push(lineValues.join(","));
        //values.push("Component " + ((i/2)+1) + ":, " + lineValues.join(", "));
        //else
        //values.push("Component " + ((i+1)/2) + ":, " + lineValues.join(", "));
    }
    var TP = []
    if (temperature_box.value.includes(".")){
        TP.push(temperature_box.value)
    }
    else TP.push(temperature_box.value+".15")
    if (pressure_box.value.includes(".")){
        TP.push(pressure_box.value)
    }
    else TP.push(pressure_box.value+".")
    values.push(TP)
  //#endregion

    values.push("0,0") //Print end of file

    // Create a text file from the values
    var textFileAsBlob = new Blob([values.join("\n")], {type: 'text/plain'});
  
    // Create a link element to download the file
    var downloadLink = document.createElement("a");
    downloadLink.download = problem_name.value+".dat";
  
    // Use createObjectURL to create a URL for the file
    downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
  
    // Click the link to download the file
    downloadLink.click();
};
//#endregion
</script>




</body>
</html>